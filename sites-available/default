server {
	listen 80 default_server;
	listen 443 default_server spdy ssl;
	listen [::]:80 ipv6only=on default_server;
	listen [::]:443 ipv6only=on default_server spdy ssl;

	root /etc/nginx/html/nonexistent;

	error_page 404 /404.html;
	location = /404.html {
		internal;
		root /etc/nginx/html/error;
	}
}

server {
	listen 80;
	listen 443;
	listen [::]:80;
	listen [::]:443;

	server_name blog.ustc.edu.cn;

        ssl_certificate     /etc/nginx/ssl-keys/blog-alphassl-bundle.crt;
        ssl_certificate_key /etc/nginx/ssl-keys/blog-alphassl-nopasswd.key;

	client_max_body_size 2m;

	include conf.d/redirect2https.inc;

	access_log  /var/log/nginx/default/access.log logverbose;
	error_log   /var/log/nginx/default/error.log;

	location / {
		root /srv/blog/http;
		index index.php index.html;
		location ~ \.php$ {
			include        fastcgi_params;
			fastcgi_pass   unix://var/run/ustcblog/php-fpm.sock;
			fastcgi_index  index.php;
			fastcgi_param  SCRIPT_FILENAME  $document_root$fastcgi_script_name;
			## security checker requires SERVER_NAME to be set
			fastcgi_param  SERVER_NAME      blog.ustc.edu.cn;
		}
	}
}
